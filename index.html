<!doctype html>
<html lang="de">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Für Надя ✨ | Dein Tageskompliment</title>
  <meta name="description" content="Ein kleines tägliches Kompliment – jeden Tag um 23:00 Uhr deutscher Zeit, nur für Nadja." />
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;800&family=Playfair+Display:wght@600&display=swap" rel="stylesheet">
  <style>
    :root{
      --bg: #0b0c12;
      --bg2:#11131b;
      --text:#f7f7fb;
      --muted:#b9bfd3;
      --accent:#ff80bf;
      --accent-2:#9bb8ff;
      --glass: rgba(255,255,255,0.06);
      --blur: 14px;
      --ring: 1px solid rgba(255,255,255,0.12);
      --shadow: 0 10px 30px rgba(0,0,0,0.35);
      --maxw: 820px;
    }
    *{box-sizing:border-box}
    html,body{height:100%}
    body{
      margin:0;
      background: radial-gradient(1200px 800px at 20% -10%, #1a1533 0%, transparent 60%),
                  radial-gradient(1200px 800px at 120% 110%, #13233f 0%, transparent 60%),
                  var(--bg);
      color:var(--text);
      font-family:Inter, system-ui, -apple-system, Segoe UI, Roboto, "Helvetica Neue", Arial, "Noto Sans", "Apple Color Emoji","Segoe UI Emoji","Segoe UI Symbol";
      line-height:1.6;
      overflow-x:hidden;
    }
    /* ✨ floating background */
    .sky{position:fixed; inset:0; overflow:hidden; z-index:-1; filter:blur(1.2px)}
    .star{
      position:absolute; bottom:-6vh;
      animation: floatUp linear infinite, twinkle ease-in-out infinite;
      opacity:.75; pointer-events:none; user-select:none;
      will-change: transform, opacity;
    }
    @keyframes floatUp{
      from{ transform: translateY(0) translateX(0) rotate(0deg); opacity: .6; }
      to{   transform: translateY(-115vh) translateX(12px) rotate(8deg); opacity: .9; }
    }
    @keyframes twinkle{
      0%,100%{ filter:blur(3px); opacity:.55 }
      50%{ filter:blur(2px); opacity:.9 }
    }

    header{
      max-width:var(--maxw);
      margin: clamp(18px, 4vw, 40px) auto 14px;
      padding: 16px 20px;
      display:flex; align-items:center; justify-content:space-between; gap:12px;
    }
    .brand{
      font-weight:800; letter-spacing:.2px; display:flex; align-items:center; gap:10px
    }
    .brand .dot{width:10px; height:10px; border-radius:50%; background:linear-gradient(145deg,var(--accent),#ffb3d9)}
    /* Tinten-Kalligrafie SVG */
    #inkSig{ 
      margin-left:10px; 
      filter: drop-shadow(0 4px 12px rgba(0,0,0,.35));
      transition: filter 0.3s ease;
    }
    #inkSig path{
      fill:none; 
      stroke: var(--text); 
      stroke-width:2.5; 
      stroke-linecap:round; 
      stroke-linejoin:round;
      vector-effect: non-scaling-stroke;
      stroke-dasharray: var(--len, 400);
      stroke-dashoffset: var(--len, 400);
    }
    @media (prefers-reduced-motion: no-preference){
      .ink-anim path{ 
        animation: inkWrite 2.2s cubic-bezier(.25,.8,.25,1) forwards; 
      }
      @keyframes inkWrite{
        to{ stroke-dashoffset: 0; }
      }
    }
    /* Dezenter Tintenschein nach dem Schreiben */
    #inkSig.done path{ 
      filter: drop-shadow(0 0 8px rgba(255,128,191,.45)); 
    }
    .brand{ cursor: pointer; user-select: none; }
    .next{
      color:var(--muted); font-size:14px
    }

    .card{
      max-width:var(--maxw);
      margin: 0 auto;
      background: linear-gradient(180deg, rgba(255,255,255,0.08), rgba(255,255,255,0.03));
      border: var(--ring);
      box-shadow: var(--shadow);
      border-radius: 16px;
      padding: clamp(18px, 4vw, 28px);
      backdrop-filter: blur(var(--blur));
    }

    .gifwrap{
      position:relative; border-radius:12px; overflow:hidden;
      background:var(--bg2);
      border: 1px solid rgba(255,255,255,0.08);
      display:flex; align-items:center; justify-content:center;
      margin-bottom:14px;
      min-height:200px;
      max-height:400px;
      width:100%;
    }
    .gifwrap img{
      max-width:100%; max-height:100%;
      width:auto; height:auto;
      object-fit:contain; display:block; opacity:.95;
      border-radius:8px;
    }

    h1{
      font-family:"Playfair Display", serif;
      font-size: clamp(26px, 4.5vw, 40px);
      margin: 6px 0 8px;
      line-height:1.25;
      letter-spacing:.2px;
    }
    .compliment{
      font-size: clamp(18px, 2.5vw, 24px);
      line-height:1.55;
      margin-top: 6px;
    }

    .meta{
      display:flex; flex-wrap:wrap; gap:10px 16px; align-items:center; margin-top:14px;
      color:var(--muted); font-size:14px;
    }
    .pill{
      display:inline-flex; align-items:center; gap:8px;
      padding:8px 12px; border-radius:100px; background:var(--glass); border:var(--ring)
    }
    .pill b{color:var(--text)}
    .memory-btn{
      display:inline-flex; align-items:center; gap:8px;
      padding:8px 14px; border-radius:100px; 
      background: linear-gradient(145deg, var(--accent), #ffb3d9);
      border:1px solid rgba(255,255,255,.12);
      color:#2b0f1c; font-weight:700; cursor:pointer;
      font-family:inherit; font-size:14px;
      box-shadow:0 4px 12px rgba(255,128,191,.25);
      transition: transform .08s ease, box-shadow .2s ease;
    }
    .memory-btn:hover{
      transform: translateY(-1px);
      box-shadow:0 6px 16px rgba(255,128,191,.35);
    }
    .memory-btn:active{ 
      transform: translateY(1px); 
      box-shadow:0 2px 8px rgba(255,128,191,.18);
    }

    footer{
      max-width:var(--maxw);
      margin: 14px auto 40px; padding: 0 20px; color:var(--muted); font-size:13px
    }

    /* hearts */
    .heart{
      position: fixed; pointer-events:none; will-change: transform, opacity;
      animation: pop 900ms cubic-bezier(.21,.98,.6,.99) forwards;
      font-size:22px; filter: drop-shadow(0 3px 10px rgba(0,0,0,.25));
    }
    @keyframes pop{
      0%{ transform: translate(-50%,-50%) scale(.6); opacity:0 }
      50%{ opacity:1 }
      100%{ transform: translate(-50%,-180%) scale(1.1) rotate(-12deg); opacity:0 }
    }

    .note{ margin-top:10px; font-size:12px; color:var(--muted) }
    .hint{ font-size:12px; color:var(--muted); margin-top:8px }
    a,button{font-family:inherit}
    /* Streak Gamification */
    @keyframes streak-pulse {
      0%, 100% { transform: scale(1); box-shadow: 0 0 0 0 rgba(255, 107, 107, 0.4); }
      50% { transform: scale(1.05); box-shadow: 0 0 20px 8px rgba(255, 107, 107, 0.2); }
    }
    .badge-item { transition: transform 0.2s ease; }
    .badge-item:hover { transform: translateY(-2px); }
    /* ===== Emoji Memory Modal ===== */
    .modal{
      position:fixed; inset:0; display:flex; align-items:center; justify-content:center;
      background: rgba(0,0,0,.45); z-index: 999; backdrop-filter: blur(4px);
    }
    .modal[hidden]{ display:none !important; }
    .modal-card{
      background: linear-gradient(180deg, rgba(255,255,255,.08), rgba(255,255,255,.03));
      border: var(--ring); border-radius:16px; box-shadow: var(--shadow);
      width:min(92vw, 860px); max-height:90vh; overflow-y:auto; padding:18px; position:relative;
    }
    .modal-close{
      position:absolute; top:8px; right:10px; font-size:28px; line-height:1;
      background:transparent; border:none; color:var(--text); cursor:pointer; padding:4px 8px;
      transition: transform 0.2s ease;
    }
    .modal-close:hover{ transform: scale(1.1); color:var(--accent); }
    #memoryTitle{ margin:0 0 12px; font-size:24px; }
    .memory-controls{ 
      display:flex; gap:10px; align-items:center; margin:8px 0 10px; flex-wrap:wrap;
    }
    .memory-controls label{ display:flex; align-items:center; gap:6px; }
    .memory-controls select{
      background:var(--bg2); color:var(--text); border:var(--ring); border-radius:8px;
      padding:6px 10px; font-family:inherit; cursor:pointer;
    }
    .memory-controls button{
      background:linear-gradient(145deg, var(--accent-2), #c5d3ff); color:#0f1a3a;
      border:none; border-radius:8px; padding:6px 12px; cursor:pointer; font-weight:600;
      transition: transform 0.1s ease;
    }
    .memory-controls button:active{ transform: translateY(1px); }
    .memory-stats{ color:var(--muted); margin-bottom:12px; font-size:14px; }
    .memory-stats span{ color:var(--text); font-weight:600; }
    
    .memory-grid{
      display:grid; gap:8px; user-select:none; margin-top:12px;
      min-height:200px;
      width:100%;
    }
    .memory-grid[data-mode="4x4"]{ grid-template-columns: repeat(4, minmax(56px,1fr)); }
    .memory-grid[data-mode="5x6"]{ grid-template-columns: repeat(6, minmax(44px,1fr)); }
    .memory-grid[data-mode="daily"]{ grid-template-columns: repeat(5, minmax(48px,1fr)); }
    
    .tile{
      position:relative; width:100%; padding-top: 120%;
      background:transparent; border:none; cursor:pointer; padding:0;
      min-width:44px; min-height:60px;
    }
    .tile-face{
      position:absolute; inset:0;
      display:flex; align-items:center; justify-content:center;
      border-radius:10px; border:1px solid rgba(255,255,255,.1);
      background: linear-gradient(145deg, rgba(255,255,255,.08), rgba(255,255,255,.02));
      box-shadow: 0 2px 8px rgba(0,0,0,.2);
      font-size: clamp(32px, 7vw, 52px);
      transition: background 0.2s ease, transform 0.1s ease;
      color: var(--muted);
    }
    .tile.flipped .tile-face{
      background: linear-gradient(145deg, #fff, #f0f0f0);
      color: #000;
      transform: scale(1.05);
    }
    .tile[disabled]{ cursor:not-allowed; }
    .tile[disabled] .tile-inner{ opacity:0.6; }
    
    @media (prefers-reduced-motion: reduce){
      .tile-inner{ transition:none; }
      .tile.flipped .tile-inner{ 
        transform:none; 
        background:var(--accent-2); 
      }
      .tile.flipped .tile-front{ display:none; }
      .tile.flipped .tile-back{ 
        transform:none; 
        display:flex;
        z-index:3;
      }
    }
    

    .tile:focus-visible{ outline:2px solid var(--accent); outline-offset:2px; border-radius:10px; }
    
    @keyframes victory-pulse{
      0%, 100%{ transform: scale(1); }
      50%{ transform: scale(1.05); }
    }

    ::selection{background:#ffd2ec; color:#2b0f1c}
  </style>
</head>
<body>
  <div class="sky" id="sky" aria-hidden="true"></div>

  <header>
    <div class="brand" id="brand">
      <span class="dot"></span><span>Für Nadja ✨</span>
      <!-- Inline-Signatur: Надя in kyrillischer Kalligrafie -->
      <svg id="inkSig" viewBox="0 0 320 80" width="140" height="35" aria-hidden="true" focusable="false">
        <!-- H (Н) - Elegant geschwungen -->
        <path d="M20,25 L20,60 M20,42 Q30,38 40,42 M40,25 L40,60" />
        <!-- A (А) - Mit schönem Bogen -->
        <path d="M60,60 L75,25 L90,60 M67,48 L83,48" />
        <!-- D (Д) - Mit Serifen -->
        <path d="M110,25 L110,55 L135,55 L135,25 M105,60 L105,55 M140,60 L140,55" />
        <!-- YA (Я) - Elegant geschwungen -->
        <path d="M160,25 Q180,25 180,42 Q180,60 160,60 L155,60 M180,42 L180,60" />
      </svg>
    </div>
    <div class="next" id="nextInfo">Nächstes Kompliment um 23:00 (deutsche Zeit)</div>
  </header>

  <main class="card" id="card">
    <div class="gifwrap" id="gifwrap" role="img" aria-label="Nette GIF-Überraschung für Nadja">
      <img id="gif" alt="Tages-GIF" />
    </div>

    <h1 id="title">Наденька,</h1>
    <div class="compliment" id="compliment">Твоя улыбка превращает обычное утро в маленькое чудо.</div>

    <div class="meta">
      <span class="pill">⏳ <b id="countdown">—:—:—</b> bis zum nächsten Kompliment</span>
      <span class="pill">🗓️ <span id="todayLabel"></span></span>
      <button class="memory-btn" id="openMemory" type="button" aria-haspopup="dialog">🎮 Memory</button>
    </div>

    <div class="hint">Совет: нажми в любом месте и насладись 💖-фейерверком :3</div>
  </main>

  <!-- Emoji Memory Modal -->
  <div id="memoryOverlay" class="modal" hidden aria-hidden="true" role="dialog" aria-modal="true" aria-labelledby="memoryTitle">
    <div class="modal-card" role="document">
      <button class="modal-close" id="memoryClose" type="button" aria-label="Schließen">×</button>
      <h2 id="memoryTitle">Emoji Memory 🎮</h2>
      
      <div class="memory-controls">
        <label>Modus:
          <select id="memoryMode">
            <option value="daily">Daily (deterministisch)</option>
            <option value="4x4">4 × 4 (8 Paare)</option>
            <option value="5x6">5 × 6 (15 Paare)</option>
          </select>
        </label>
        <button id="memoryRestart" type="button">🔄 Neu mischen</button>
      </div>
      
      <div id="memoryStats" class="memory-stats">
        ⏱️ <span id="memTime">00:00</span> • 🎯 Züge: <span id="memMoves">0</span> • 🏆 Best: <span id="memBest">—</span>
      </div>
      <div id="memoryGrid" class="memory-grid" aria-live="polite"></div>
    </div>
  </div>

  <footer>
    <div>Mit Liebe gebaut. Твоё маленькое 23:00-окошко радости. ✨</div>
  </footer>

  <script>
    // -----------------------------
    // Config
    // -----------------------------
    const TIMEZONE = "Europe/Berlin";
    const ROTATE_HOUR = 23; // 23:00 deutscher Zeit
    const TENOR_API_KEY = "AIzaSyCCrf5nV6vaaeUnrSPzRffETe72N4sSx1k"; // Tenor API Key
    const NICKNAMES = ["Надя","Наденька","Надюша","Надюшка","Надечка","Надежда моя","Наденька-солнышко","Надю"];
    const NAME_BASE = "Надя";
    // --------- Streak & Gamification ---------
    const STREAK_CONFIG = {
      milestones: [
        { count: 3, emoji: '🥉', label: '3 Tage' },
        { count: 7, emoji: '🥈', label: '1 Woche' },
        { count: 14, emoji: '🥇', label: '2 Wochen' },
        { count: 30, emoji: '🏆', label: '1 Monat' },
        { count: 50, emoji: '💫', label: '50 Tage' },
        { count: 100, emoji: '👑', label: '100 Tage!' }
      ]
    };

    class StreakManager {
      constructor() {
        this.storageKey = 'nadja_streak_data';
        this.canUseStorage = this.checkStorage();
      }
      checkStorage() {
        try { const test = '__test__'; localStorage.setItem(test, test); localStorage.removeItem(test); return true; } catch (e) { return false; }
      }
      loadData() {
        if (!this.canUseStorage) return { current: 0, best: 0, lastVisit: null, milestones: [] };
        try { const raw = localStorage.getItem(this.storageKey); if (!raw) return { current: 0, best: 0, lastVisit: null, milestones: [] }; return JSON.parse(raw); } catch (e) { return { current: 0, best: 0, lastVisit: null, milestones: [] }; }
      }
      saveData(data) { if (!this.canUseStorage) return; try { localStorage.setItem(this.storageKey, JSON.stringify(data)); } catch (e) {} }
      getDayKey(nowParts) { const rotYMD = rotationYMD(nowParts); return `${rotYMD.year}-${String(rotYMD.month).padStart(2, '0')}-${String(rotYMD.day).padStart(2, '0')}`; }
      update(nowParts) {
        const data = this.loadData();
        const todayKey = this.getDayKey(nowParts);
        if (!data.lastVisit) { data.current = 1; data.best = 1; data.lastVisit = todayKey; data.milestones = this.checkNewMilestone(0, 1); this.saveData(data); return { ...data, isNewMilestone: data.milestones.length > 0 }; }
        if (data.lastVisit === todayKey) return { ...data, isNewMilestone: false };
        const lastDate = new Date(data.lastVisit + 'T00:00:00Z'); const todayDate = new Date(todayKey + 'T00:00:00Z');
        const diffMs = todayDate - lastDate; const diffDays = Math.floor(diffMs / (1000 * 60 * 60 * 24)); const oldCurrent = data.current;
        if (diffDays === 1) { data.current += 1; if (data.current > data.best) { data.best = data.current; } } else { data.current = 1; }
        data.lastVisit = todayKey; const newMilestones = this.checkNewMilestone(oldCurrent, data.current);
        data.milestones = [...new Set([...(data.milestones || []), ...newMilestones])]; this.saveData(data); return { ...data, isNewMilestone: newMilestones.length > 0 };
      }
      checkNewMilestone(oldCount, newCount) { const achieved = []; STREAK_CONFIG.milestones.forEach(m => { if (newCount >= m.count && oldCount < m.count) { achieved.push(m.count); } }); return achieved; }
      getAchievedBadges(milestones) { if (!milestones || !Array.isArray(milestones)) return []; return STREAK_CONFIG.milestones.filter(m => milestones.includes(m.count)); }
    }

    const streakManager = new StreakManager();
    function renderStreakUI(streakData) {
      const metaDiv = document.querySelector('.meta'); if (!metaDiv) return;
      const oldStreakPill = document.getElementById('streakPill'); const oldBadgesDiv = document.getElementById('badgesDiv');
      if (oldStreakPill) oldStreakPill.remove(); if (oldBadgesDiv) oldBadgesDiv.remove();
      if (streakData.current === 0) return;
      const streakPill = document.createElement('span'); streakPill.id = 'streakPill'; streakPill.className = 'pill';
      streakPill.style.background = 'linear-gradient(145deg, #ff6b6b, #ff8787)'; streakPill.style.color = 'white'; streakPill.style.fontWeight = '600';
      if (streakData.isNewMilestone && !window.matchMedia('(prefers-reduced-motion: reduce)').matches) { streakPill.style.animation = 'streak-pulse 2s ease-in-out'; }
      const bestText = streakData.best > streakData.current ? ` · Best: ${streakData.best}` : '';
      streakPill.innerHTML = '🔥 <b>Streak ' + streakData.current + '</b>' + bestText; metaDiv.appendChild(streakPill);
      const achievedBadges = streakManager.getAchievedBadges(streakData.milestones);
      if (achievedBadges.length > 0) {
        const badgesDiv = document.createElement('div'); badgesDiv.id = 'badgesDiv'; badgesDiv.style.display = 'flex'; badgesDiv.style.gap = '8px';
        badgesDiv.style.flexWrap = 'wrap'; badgesDiv.style.marginTop = '12px'; badgesDiv.style.marginBottom = '4px';
        achievedBadges.forEach(badge => {
          const badgeSpan = document.createElement('span'); badgeSpan.className = 'badge-item'; badgeSpan.style.display = 'inline-flex';
          badgeSpan.style.alignItems = 'center'; badgeSpan.style.gap = '4px'; badgeSpan.style.padding = '6px 10px'; badgeSpan.style.borderRadius = '8px';
          badgeSpan.style.background = 'rgba(255, 255, 255, 0.08)'; badgeSpan.style.border = '1px solid rgba(255, 255, 255, 0.12)';
          badgeSpan.style.fontSize = '13px'; badgeSpan.style.color = 'var(--muted)';
          badgeSpan.innerHTML = badge.emoji + ' <span style="color: var(--text); font-weight: 600;">' + badge.label + '</span>';
          badgesDiv.appendChild(badgeSpan);
        });
        metaDiv.parentElement.insertBefore(badgesDiv, metaDiv.nextSibling);
      }
    }


    // --------- Tenor API Search Terms ---------
    const TENOR_SEARCH_TERMS = {
      hearts: [
        "bubu dudu love","kakao friends heart","sanrio heart","hello kitty heart",
        "slay queen heart","queen energy cute",
        "pastel heart animation","kawaii heart sticker","sparkle heart ✨","soft love aesthetic",
        "сладкие сердечки","pastell herz ästhetik", "cute dog"
      ],
      calm: [
        "yoga aesthetic pastel","breathing calm loop","lofi study cozy","cozy book reading",
        "soft meditation animation","calm ocean loop","serene nature aesthetic",
        "интроверт уют эстетика","ruhig ästhetik","soft rain calm window"
      ],
      sport: [
        "bubu dudu workout","kakao friends yoga","sanrio gym cute",
        "running aesthetic girl","yoga flow pastel","stretch cute loop",
        "thrasher skate aesthetic","skateboard aesthetic loop",
        "sport motivation cute","workout sticker"
      ],
      sketch: [
        "pastel drawing loop","cute doodle notebook","sketchbook aesthetic",
        "line art animation","copic pastel draw","kawaii doodle sticker",
        "милый дудл","zeichnen pastell"
      ],
      cozy: [
        "lofi girl aesthetic","cozy coffee steam","warm blanket aesthetic",
        "room ambient cozy lights","tea time cute","snuggle sticker",
        "gemütlich ästhetik","уютно эстетика"
      ],
      design: [
        "pastel ui design","minimalist grid aesthetic","typography aesthetic",
        "coquette design","pinterest aesthetic board","vintage style edit",
        "sanrio pastel ui","kakao friends minimal","kawaii layout"
      ],
      future: [
        "pastel galaxy","cosmic aesthetic dreamy","shooting star cute",
        "rocket kawaii","space window view","neon city dreamy",
        "berlin aesthetic night","city skyline pastel",
        "космос пастель","kosmos ästhetik"
      ],
      stars: [
        "sparkle stars ✨","dreamy night sky","shooting star pastel",
        "moon and stars kawaii","bubu dudu stars","sanrio moon stars",
        "звёзды нежные","sterne pastell"
      ],
      sun: [
        "golden hour aesthetic","soft sunlight dust","morning sun window",
        "sunbeam sparkle","bubu dudu sunshine","hello kitty sunny",
        "золотой час эстетика","goldene stunde ästhetik"
      ],
      rain: [
        "cozy rain window","rain bokeh aesthetic","umbrella cute",
        "sanrio rain","bubu dudu rain","kakao friends rain",
        "regen am fenster","дождь у окна"
      ],
      cat: [
        "kawaii cat","hello kitty cute","sanrio cat","pastel kitten",
        "chonky cat cute","cat cuddle sticker","сладкий котик","süße katze"
      ]
    };

    // Cache & Fallbacks
    const tenorCache = {};
    const FALLBACK_GIFS = [
      "https://media.giphy.com/media/26BRv0ThflsHCqDrG/giphy.gif",
      "https://media.giphy.com/media/3oriO0OEd9QIDdllqo/giphy.gif",
      "https://media.giphy.com/media/xT9IgG50Fb7Mi0prBC/giphy.gif"
    ];

    // --------- Komplimente ---------
    const COMPLIMENTS = [
      {caption:"Восточноевропейская красота {NICK} 🌸", theme: "hearts", text:"В твоих чертах лица читается целая история красоты и силы."},
      {caption:"Языковая магия {NICK} 🗣️", theme: "calm", text:"Ты превращаешь изучение языков в искусство понимания душ."},
      {caption:"Спортивная грация {NICK} 🏃‍♀️", theme: "sport", text:"Твоя дисциплина в спорте отражает силу твоего характера."},
      {caption:"Творческая душа {NICK} 🎨", theme: "sketch", text:"В каждом твоём творении живёт частичка твоего прекрасного мира."},
      {caption:"Музыкальное сердце {NICK} 🎵", theme: "cozy", text:"Твой музыкальный вкус говорит о глубине твоей души."},
      {caption:"Стильная натура {NICK} 👗", theme: "design", text:"Твой стиль это не просто одежда, это способ выражения себя."},
      {caption:"Семейная теплота {NICK} 👨‍👩‍👧‍👦", theme: "cozy", text:"Любовь к семье делает тебя ещё более особенной."},
      {caption:"Мудрость сердца {NICK} 💭", theme: "calm", text:"Ты умеешь находить красоту даже в самых сложных моментах."},
      {caption:"Открытая книга {NICK} 📚", theme: "sketch", text:"Твоя честность и открытость делают общение с тобой особенным."},
      {caption:"Путешественница по жизни {NICK} 🌍", theme: "future", text:"Каждый твой переезд это новая глава удивительной истории."},
      {caption:"Адаптивная сила {NICK} 💪", theme: "sport", text:"Твоя способность приспосабливаться вызывает искреннее восхищение."},
      {caption:"Интровертная магия {NICK} 🌙", theme: "calm", text:"В твоей тишине скрыта целая вселенная интересных мыслей."},
      {caption:"Дизайнерское видение {NICK} 👁️", theme: "design", text:"Ты видишь красоту там, где другие видят обыденность."},
      {caption:"Йога-философия {NICK} 🧘‍♀️", theme: "calm", text:"Твоя гармония с собой излучается на всех вокруг."},
      {caption:"Винтажная душа {NICK} 📻", theme: "design", text:"Твой стиль сочетает лучшее из прошлого и настоящего."},
      {caption:"Трешер-эстетика {NICK} 🛹", theme: "sport", text:"В твоём стиле чувствуется свобода и независимость духа."},
      {caption:"Берлинская мечта {NICK} 🏙️", theme: "future", text:"Этот город станет ещё прекраснее с твоим присутствием."},
      {caption:"Многоязычная красота {NICK} 🌐", theme: "sketch", text:"Каждый язык, который ты знаешь, добавляет тебе очарования."},
      {caption:"Искренность взгляда {NICK} 👀", theme: "hearts", text:"В твоих глазах читается такая честность и доброта."},
      {caption:"Творческий процесс {NICK} ✏️", theme: "sketch", text:"Наблюдать за тем, как ты творишь, это настоящее удовольствие."},
      {caption:"Музыкальная терапия {NICK} 🎧", theme: "cozy", text:"Твоя музыка лечит не только тебя, но и всех вокруг."},
      {caption:"Стрессоустойчивость {NICK} 🌊", theme: "calm", text:"Твоя способность справляться с трудностями просто поражает."},
      {caption:"Семейные ценности {NICK} 💝", theme: "hearts", text:"Твоя любовь к близким показывает, какое у тебя большое сердце."},
      {caption:"Адаптация-мастер {NICK} 🦋", theme: "future", text:"Ты превращаешь каждую перемену в новую возможность."},
      {caption:"Эстетика Pinterest {NICK} 📌", theme: "design", text:"Твой вкус в визуальном искусстве просто безупречен."},
      {caption:"Спонтанная радость {NICK} 🎉", theme: "stars", text:"Твоя способность радоваться мелочам заразительна."},
      {caption:"Лингвистический талант {NICK} 🗣️", theme: "sketch", text:"Ты жонглируешь языками как настоящий артист слова."},
      {caption:"Внутренняя сила {NICK} 💎", theme: "calm", text:"В тебе столько внутренней силы, что хватит на всех."},
      {caption:"Культурный мост {NICK} 🌉", theme: "future", text:"Ты соединяешь культуры своим пониманием и теплотой."},
      {caption:"Художественная натура {NICK} 🖼️", theme: "sketch", text:"Каждое твоё творение несёт отпечаток твоей прекрасной души."},
      {caption:"Музыкальная интуиция {NICK} 🎼", theme: "cozy", text:"Ты чувствуешь музыку не только ушами, но и сердцем."},
      {caption:"Стильная индивидуальность {NICK} ✨", theme: "design", text:"Твой стиль это отражение твоей уникальной личности."},
      {caption:"Жизненная мудрость {NICK} 🦉", theme: "calm", text:"Несмотря на молодость, в тебе живёт древняя мудрость."},
      {caption:"Творческая энергия {NICK} ⚡", theme: "sketch", text:"Твоя креативность освещает всё вокруг ярким светом."},
      {caption:"Семейная гордость {NICK} 👑", theme: "hearts", text:"Твоя семья может гордиться такой удивительной дочерью."},
      {caption:"Многогранная личность {NICK} 💠", theme: "stars", text:"В тебе столько граней, что каждый день открываю что-то новое."},
      {caption:"Эмоциональный интеллект {NICK} 🧠", theme: "calm", text:"Ты понимаешь чувства лучше, чем многие психологи."},
      {caption:"Визуальная поэзия {NICK} 📸", theme: "design", text:"Твоё чувство прекрасного превращает обычное в искусство."},
      {caption:"Жизненная стойкость {NICK} 🌳", theme: "future", text:"Как дерево, ты растёшь сильнее после каждой бури."},
      {caption:"Интуитивная мудрость {NICK} 🔮", theme: "cozy", text:"Твоя интуиция ведёт тебя по правильному пути жизни."},
      {caption:"Утренняя магия для {NICK} ✨", theme: "sun", text:"Твоя улыбка превращает обычное утро в маленькое чудо."},
      {caption:"Секретная суперсила {NICK} 💫", theme: "hearts", text:"Ты умеешь делать сложные вещи лёгкими, а грустные светлыми."},
      {caption:"Творческий вихрь {NICK} 🎨", theme: "sketch", text:"Каждая твоя идея это маленькая вселенная, полная красоты."},
      {caption:"Дизайнерская душа {NICK} ✨", theme: "design", text:"Ты видишь гармонию там, где другие видят хаос."},
      {caption:"Энергия движения {NICK} 🌟", theme: "sport", text:"Твоя решимость заразительна, рядом с тобой хочется горы свернуть."},
      {caption:"Уютный мир {NICK} ☕", theme: "cozy", text:"В твоих объятиях даже самый холодный день становится тёплым."},
      {caption:"Танец под дождём {NICK} 🌧️", theme: "rain", text:"Ты находишь красоту в каждой капле, в каждом моменте."},
      {caption:"Мечтательница {NICK} 🚀", theme: "future", text:"Твои мечты не просто красивы, они обязательно сбудутся."},
      {caption:"Звёздная пыль {NICK} ⭐", theme: "stars", text:"Ты сияешь так ярко, что даже звёзды завидуют."},
      {caption:"Палитра чувств {NICK} 🎨", theme: "design", text:"Твоё сердце это целая радуга эмоций и нежности."},
      {caption:"Завтрашний день {NICK} 🌅", theme: "future", text:"Каждое твоё завтра будет лучше вчерашнего, это закон вселенной."},
      {caption:"Художница жизни {NICK} ✏️", theme: "sketch", text:"Ты рисуешь счастье в воздухе одним своим присутствием."},
      {caption:"Нежная сила {NICK} 💕", theme: "hearts", text:"Твоя доброта это не слабость, а самая настоящая суперсила."},
      {caption:"Солнечный луч {NICK} ☀️", theme: "sun", text:"Даже в самый пасмурный день ты остаёшься моим личным солнцем."},
      {caption:"Идеальный момент {NICK} ⏰", theme: "calm", text:"С тобой каждая секунда превращается в драгоценность."},
      {caption:"Формула красоты {NICK} 📐", theme: "design", text:"Математика не может объяснить, почему ты так прекрасна."},
      {caption:"Мелодия дня {NICK} 🎵", theme: "cozy", text:"Твой смех самая красивая песня, которую я когда-либо слышал."},
      {caption:"Внутренняя погода {NICK} 🌤️", theme: "sun", text:"У тебя внутри всегда весна, даже когда снаружи зима."},
      {caption:"Дизайн-мышление {NICK} 💡", theme: "design", text:"Ты создаёшь красоту не только в работе, но и в жизни."},
      {caption:"Медитация с {NICK} 🧘‍♀️", theme: "calm", text:"Рядом с тобой мир становится тише и добрее."},
      {caption:"Спортивный дух {NICK} 🏃‍♀️", theme: "sport", text:"Ты не просто достигаешь целей, ты вдохновляешь других на подвиги."},
      {caption:"Домашний уют {NICK} 🏠", theme: "cozy", text:"Дом это не место, это ощущение тепла, которое ты даришь."},
      {caption:"Творческий блокнот {NICK} 📝", theme: "sketch", text:"Каждая твоя мысль достойна быть запечатлённой золотыми буквами."},
      {caption:"Берлинские дожди и {NICK} 🌧️", theme: "rain", text:"Даже серое небо Берлина не может затмить твоё сияние."},
      {caption:"Магия возможного {NICK} ✨", theme: "hearts", text:"Ты превращаешь 'невозможно' в 'а почему бы и нет?'."},
      {caption:"Пиксель-арт души {NICK} 🖥️", theme: "design", text:"Каждая деталь в тебе продумана вселенной до совершенства."},
      {caption:"Набросок счастья {NICK} ✏️", theme: "sketch", text:"Твоё счастье заразительно, оно рисует улыбки на лицах других."},
      {caption:"История любви {NICK} 💕", theme: "hearts", text:"Каждый день с тобой это новая глава прекрасной истории."},
      {caption:"Праздник в будни {NICK} 🎉", theme: "stars", text:"Ты умеешь превращать обычный день в незабываемое приключение."},
      {caption:"Кроссовки и мечты {NICK} 👟", theme: "sport", text:"Каждый твой шаг приближает тебя к чему-то удивительному."},
      {caption:"Зимнее тепло {NICK} ❄️", theme: "cozy", text:"Ты тот самый горячий чай в холодный день, который согревает душу."},
      {caption:"Космические планы {NICK} 🚀", theme: "future", text:"Твоё будущее сияет ярче любой звезды во вселенной."},
      {caption:"Аутентичность {NICK} 🌟", theme: "hearts", text:"Быть собой твоя суперсила, и ты владеешь ею в совершенстве."},
      {caption:"Звёздное желание {NICK} ⭐", theme: "stars", text:"Пусть каждое твоё желание исполняется быстрее, чем падающая звезда."},
      {caption:"Цифровая магия {NICK} 💻", theme: "design", text:"Ты оживляешь пиксели и превращаешь код в искусство."},
      {caption:"Солнечный прорыв {NICK} ☀️", theme: "sun", text:"Ты тот самый луч света, который пробивается сквозь тучи."},
      {caption:"Золотое сечение {NICK} 📏", theme: "design", text:"В тебе идеально сочетаются красота, ум и доброта."},
      {caption:"Объятия тишины {NICK} 🤗", theme: "cozy", text:"Иногда лучшие моменты это просто молчание рядом с тобой."},
      {caption:"Волшебство обычного {NICK} ✨", theme: "stars", text:"Ты находишь чудеса в самых простых вещах, и это прекрасно."},
      {caption:"Котики и комфорт {NICK} 🐱", theme: "cat", text:"Твоя нежность может растопить даже самое холодное сердце."},
      {caption:"Глубокие воды {NICK} 🌊", theme: "calm", text:"В твоей душе столько глубины и мудрости, целый океан."},
      {caption:"Креативная лаборатория {NICK} 🔬", theme: "design", text:"Каждая твоя идея это эксперимент, который обязательно удастся."},
      {caption:"Вопросы и открытия {NICK} ❓", theme: "future", text:"Твоё любопытство это компас, который ведёт к удивительным открытиям."},
      {caption:"Февральское чудо {NICK} 💝", theme: "cozy", text:"Даже самый короткий месяц становится бесконечным, когда проводишь его с тобой."},
      {caption:"Завтра в твоих руках {NICK} 🌅", theme: "sun", text:"Будущее не может дождаться встречи с тобой, оно уже влюблено."},
      {caption:"Энергия движения {NICK} ⚡", theme: "sport", text:"Твоя энергия заряжает всех вокруг на подвиги и мечты."},
      {caption:"Карандашные мечты {NICK} ✏️", theme: "sketch", text:"Каждый твой рисунок это окно в мир, где всё возможно."},
      {caption:"Рецепт счастья {NICK} 📖", theme: "cozy", text:"Ингредиенты простые: твоя улыбка, тёплый чай и немного волшебства."}
    ];

    // -----------------------------
    // Time helpers
    // -----------------------------
    const fmtFull = new Intl.DateTimeFormat('en-CA', {
      timeZone: TIMEZONE, hour12:false,
      year:'numeric', month:'2-digit', day:'2-digit',
      hour:'2-digit', minute:'2-digit', second:'2-digit'
    });
    function partsFrom(date){
      const p = {};
      for (const part of fmtFull.formatToParts(date)){ p[part.type] = part.value; }
      ['year','month','day','hour','minute','second'].forEach(k => p[k] = parseInt(p[k],10));
      return p;
    }
    function labelForToday(){
      const p = partsFrom(new Date());
      const days = ["So","Mo","Di","Mi","Do","Fr","Sa"];
      const d = new Date(p.year, p.month-1, p.day);
      return `${days[d.getDay()]} ${String(p.day).padStart(2,'0')}.${String(p.month).padStart(2,'0')}.${p.year}`;
    }
    function previousYMD(p){
      const d = new Date(Date.UTC(p.year, p.month-1, p.day));
      d.setUTCDate(d.getUTCDate()-1);
      return { year:d.getUTCFullYear(), month:d.getUTCMonth()+1, day:d.getUTCDate() };
    }
    function rotationYMD(nowParts){
      // "Tag" beginnt um 23:00 Berlin – vor 23:00 gehört noch zum Vortag
      if(nowParts.hour < ROTATE_HOUR){
        return previousYMD(nowParts);
      }
      return {year: nowParts.year, month: nowParts.month, day: nowParts.day};
    }
    function dayIndex(ymd){
      const ms = Date.UTC(ymd.year, ymd.month-1, ymd.day);
      const day = Math.floor(ms / 86400000);
      const n = COMPLIMENTS.length;
      return ((day % n) + n) % n;
    }
    function nextRotationParts(nowParts){
      let y = nowParts.year, m = nowParts.month, d = nowParts.day;
      if(nowParts.hour >= ROTATE_HOUR) {
        const dt = new Date(Date.UTC(y, m-1, d));
        dt.setUTCDate(dt.getUTCDate()+1);
        y = dt.getUTCFullYear(); m = dt.getUTCMonth()+1; d = dt.getUTCDate();
      }
      return {year:y, month:m, day:d, hour:ROTATE_HOUR, minute:0, second:0};
    }
    function roughCountdown(nowParts, targetParts){
      const toSec = p => p.hour*3600 + p.minute*60 + p.second;
      let days = 0;
      let ns = toSec(nowParts);
      let ts = toSec(targetParts);
      if(nowParts.year===targetParts.year && nowParts.month===targetParts.month && nowParts.day===targetParts.day){
        if(ts < ns){ days = 1; }
      } else {
        days = 1;
      }
      let secs = (days*24*3600 - ns + ts);
      if(secs < 0) secs = 0;
      const h = Math.floor(secs/3600);
      const m = Math.floor((secs%3600)/60);
      const s = secs%60;
      return {h,m,s};
    }
    function fill(str, nick){ return (str||"").replaceAll("{NICK}", nick || NAME_BASE); }

    // -----------------------------
    // Tenor API
    // -----------------------------
    async function fetchTenorGifs(theme, dayIndex) {
      const cacheKey = `${theme}_${dayIndex}`;
      if (tenorCache[cacheKey]) return tenorCache[cacheKey];

      const terms = TENOR_SEARCH_TERMS[theme] || TENOR_SEARCH_TERMS.hearts;
      const searchTerm = terms[dayIndex % terms.length];

      try {
        const url = `https://tenor.googleapis.com/v2/search?q=${encodeURIComponent(searchTerm)}&key=${TENOR_API_KEY}&client_key=nadja_compliments&limit=50&media_filter=gif&contentfilter=high&ar_range=standard`;
        const response = await fetch(url);
        if (!response.ok) throw new Error(`Tenor API Error: ${response.status}`);

        const data = await response.json();
        const filtered = data.results?.filter(r => {
          const gif = r.media_formats?.gif;
          if (!gif) return false;
          const w = parseInt(gif.dims?.[0])||0, h = parseInt(gif.dims?.[1])||0;
          if (w && h) {
            const ratio = w/h; if (ratio < 0.5 || ratio > 3) return false;
          }
          const size = parseInt(gif.size)||0; if (size > 5000000) return false;
          return true;
        }).map(r => r.media_formats.gif.url) || [];

        tenorCache[cacheKey] = filtered;
        return filtered;
      } catch (e) {
        console.warn('Tenor API failed:', e);
        return FALLBACK_GIFS;
      }
    }

    async function selectGifForDay(theme, dayIndex) {
      const gifs = await fetchTenorGifs(theme, dayIndex);
      if (!gifs.length) return FALLBACK_GIFS[dayIndex % FALLBACK_GIFS.length];
      return gifs[dayIndex % gifs.length];
    }

    // -----------------------------
    // UI logic
    // -----------------------------
    const elTitle = document.getElementById('title');
    const elCompliment = document.getElementById('compliment');
    const elCountdown = document.getElementById('countdown');
    const elToday = document.getElementById('todayLabel');
    const elNextInfo = document.getElementById('nextInfo');
    const elGif = document.getElementById('gif');

    function selectNick(idx){ return NICKNAMES[idx % NICKNAMES.length] || NAME_BASE; }

    function tryLoadGif(url){
      const img = new Image();
      img.onload = ()=>{
        const gifWidth = img.naturalWidth;
        const gifHeight = img.naturalHeight;
        const containerWidth = elGif.parentElement.clientWidth;
        const aspectRatio = gifWidth / gifHeight;
        let optimalHeight = containerWidth / aspectRatio;
        optimalHeight = Math.max(200, Math.min(400, optimalHeight));
        elGif.parentElement.style.height = optimalHeight + 'px';
        elGif.src = url;
        elGif.style.opacity = '1';
      };
      img.onerror = ()=>{
        elGif.parentElement.style.height = '300px';
        elGif.src = FALLBACK_GIFS[0];
        elGif.style.opacity = '1';
      };
      elGif.style.opacity = '0.5';
      img.src = url;
    }

    async function updateUI(forceIndex){
      const now = new Date();
      const nowParts = partsFrom(now);
      const activeYMD = rotationYMD(nowParts);
      const baseIdx = dayIndex(activeYMD);
      const idx = (typeof forceIndex==='number') ? ((forceIndex % COMPLIMENTS.length)+COMPLIMENTS.length)%COMPLIMENTS.length : baseIdx;

      const nick = selectNick(idx);
      const item = COMPLIMENTS[idx];

      elTitle.textContent = `${nick},`;
      elCompliment.textContent = item.text;
      elToday.textContent = labelForToday();

      try {
        const gifUrl = await selectGifForDay(item.theme, idx);
        tryLoadGif(gifUrl);
      } catch (e) {
        console.warn('Failed to load Tenor GIF:', e);
        tryLoadGif(FALLBACK_GIFS[idx % FALLBACK_GIFS.length]);
      }

      const target = nextRotationParts(nowParts);
      const dd = roughCountdown(nowParts, target);
      elCountdown.textContent = `${String(dd.h).padStart(2,'0')}:${String(dd.m).padStart(2,'0')}:${String(dd.s).padStart(2,'0')}`;
elNextInfo.textContent = `Nächstes Kompliment um ${String(ROTATE_HOUR).padStart(2,'0')}:00 (${TIMEZONE.replace('Europe/','')})`;

      // Streak Update
      const streakData = streakManager.update(nowParts);
      renderStreakUI(streakData);;
    }

    // tick
    let previewOffset = 0;
    setInterval(()=>{
      const nowParts = partsFrom(new Date());
      const realIdx = dayIndex(rotationYMD(nowParts));
      updateUI(realIdx + previewOffset);

      // harte Umschalt-Logik exakt bei 23:00 Berlin
      if(nowParts.hour===ROTATE_HOUR && nowParts.minute===0 && nowParts.second===0){
        previewOffset = 0;
        updateUI();
      }
    }, 1000);

    // Resize-Handler
    window.addEventListener('resize', ()=>{
      const currentGif = elGif.src;
      if(currentGif && !currentGif.includes('data:')) {
        tryLoadGif(currentGif);
      }
    });

    // hearts on click
    window.addEventListener('pointerdown', e=>{ makeHeart(e.clientX, e.clientY); });
    function makeHeart(x,y){
      const el = document.createElement('div');
      el.className='heart';
      el.textContent = Math.random() < .5 ? '❤️' : '💖';
      el.style.left = x+'px'; el.style.top = y+'px';
      el.style.zIndex = 1000;
      document.body.appendChild(el);
      setTimeout(()=> el.remove(), 950);
    }

    // ✨ background stars
    (function makeStars(){
      const sky = document.getElementById('sky');
      const count = 38;
      for(let i=0;i<count;i++){
        const s = document.createElement('span');
        s.className = 'star';
        s.textContent = '✨';
        const size = (Math.random()*22)+10;
        const left = Math.random()*100;
        const dur = 22 + Math.random()*34;
        const delay = Math.random()*-dur;
        s.style.left = left+'vw';
        s.style.fontSize = size+'px';
        s.style.animationDuration = `${dur}s, ${6 + Math.random()*6}s`;
        s.style.animationDelay = `${delay}s, ${Math.random()*2}s`;
        s.style.opacity = (0.55 + Math.random()*0.4).toFixed(2);
        sky.appendChild(s);
      }
    })();

    // initial load
    updateUI();

    // ===== Tinten-Kalligrafie Animation =====
    function initInkSignature(){
      const svg = document.getElementById('inkSig');
      if(!svg) return;
      
      const reduce = window.matchMedia('(prefers-reduced-motion: reduce)').matches;
      
      // Länge pro Pfad berechnen → dasharray/offset setzen
      const paths = svg.querySelectorAll('path');
      paths.forEach(p=>{
        try{
          const len = Math.max(1, Math.round(p.getTotalLength()));
          p.style.setProperty('--len', len);
          p.style.strokeDasharray = String(len);
          p.style.strokeDashoffset = String(len);
        }catch(e){}
      });
      
      function play(){
        if(reduce){
          // Keine Animation: direkt "fertig"
          svg.classList.remove('ink-anim');
          svg.classList.add('done');
          paths.forEach(p=>{ p.style.strokeDashoffset = '0'; });
          return;
        }
        svg.classList.remove('done');
        svg.classList.remove('ink-anim');
        void svg.offsetWidth; // reflow zum Neustarten
        svg.classList.add('ink-anim');
        // Nach Ende leichten Glow setzen
        setTimeout(()=>{ svg.classList.add('done'); }, 2300);
      }
      
      // Initial starten
      play();
      
      // Re-ink bei Klick auf Brand
      document.getElementById('brand')?.addEventListener('pointerdown', (e)=>{
        // Nur triggern wenn nicht auf Button geklickt
        if(!e.target.closest('button')){
          play();
        }
      });
    }
    
    // Nach DOM-Load initialisieren
    initInkSignature();


    // ===== Emoji Memory Game =====
    const memoryUI = {
      openBtn: document.getElementById('openMemory'),
      overlay: document.getElementById('memoryOverlay'),
      closeBtn: document.getElementById('memoryClose'),
      modeSel: document.getElementById('memoryMode'),
      restartBtn: document.getElementById('memoryRestart'),
      grid: document.getElementById('memoryGrid'),
      time: document.getElementById('memTime'),
      moves: document.getElementById('memMoves'),
      best: document.getElementById('memBest'),
    };
    let memoryState = null;
    let lastFocusEl = null;

    const EMOJI_POOL = [
      // Tiere - süß & niedlich
      '🐱','🐈','🐈‍⬛','🐕','🐶','🐕‍🦺','🐩','🐰','🐇','🐹','🐭','🐻','🐻‍❄️','🧸',
      '🐼','🐨','🐯','🦁','🐮','🐷','🐸','🐵','🐔','🐧','🐦','🦆','🦉','🦄','🐴',
      '🦋','🐝','🐞','🐌','🦔','🐾','🦊','🐙',
      
      // Herzen - verschiedene Farben & Styles
      '💖','💝','💘','💕','💗','💓','💞','💜','💙','💚','🧡','💛','🤍','🖤','🤎',
      '❤️','❣️','💟','💌',
      
      // Essen & Trinken - süß & lecker
      '🍓','🍒','🍑','🍊','🍋','🍌','🍉','🍇','🍎','🍏','🥝','🍐','🫐',
      '🍰','🧁','🍪','🍩','🍭','🍬','🍫','🍮','🍯','🎂',
      '☕','🍵','🧃','🥤','🧋',
      
      // Natur & Blumen
      '🌸','🌺','🌻','🌷','🌹','🥀','🏵️','💐','🌼','🌾','🍀','🌿','🌱',
      '🌈','⭐','✨','💫','🌟','⚡','☀️','🌙','🌝','☁️','🌤️',
      
      // Aktivitäten & Objekte
      '🎀','🎁','🎈','🎉','🎊','🎵','🎶','🎧','🎨','🖌️','✏️','📚','📖',
      '🧶','🪡','🪢','🧵','🪄','🔮','💎','👑','🦢',
      
      // Smileys - fröhlich & süß
      '😊','😄','😁','🥰','😍','🤗','😘','😚','😙','🥳','😇','🤩','😻',
      '😸','😺','😽','🙀','😼','😹','😾',
      
      // Sonstiges süß
      '🍦','🧊','🌠','🪐','🌏','🎪','🎭','🎬','📷','🌃','🎇','🎆'
    ];

    function ymdToStr(ymd){ return `${ymd.year}-${String(ymd.month).padStart(2,'0')}-${String(ymd.day).padStart(2,'0')}`; }

    function seededRng(seedStr){
      let h=1779033703^seedStr.length;
      for(let i=0;i<seedStr.length;i++){ h = Math.imul(h^seedStr.charCodeAt(i), 3432918353); h = (h<<13)|(h>>>19); }
      return ()=>{ h = Math.imul(h^ (h>>>16), 2246822507); h = Math.imul(h^ (h>>>13), 3266489909); const t = (h^ (h>>>16))>>>0; return t/4294967296; };
    }

    function deckForMode(mode){
      let cols, rows, pairs;
      if(mode==='4x4'){ cols=4; rows=4; pairs=8; }
      else if(mode==='5x6'){ cols=6; rows=5; pairs=15; }
      else { cols=5; rows=4; pairs=10; }

      const now = new Date();
      const ymd = rotationYMD(partsFrom(now));
      const seed = (mode==='daily') ? `daily-${ymdToStr(ymd)}` : `free-${mode}-${now.getTime()}`;
      const rnd = seededRng(seed);

      const candidates = [...EMOJI_POOL];
      for(let i=candidates.length-1;i>0;i--){ const j = Math.floor(rnd()*(i+1)); [candidates[i],candidates[j]]=[candidates[j],candidates[i]]; }
      const pick = candidates.slice(0,pairs);
      const deck = [...pick, ...pick].map((e,i)=>({id:i, emoji:e}));
      for(let i=deck.length-1;i>0;i--){ const j = Math.floor(rnd()*(i+1)); [deck[i],deck[j]]=[deck[j],deck[i]]; }
      return {cols,rows,deck};
    }

    function fmtTime(sec){ const m=Math.floor(sec/60), s=sec%60; return `${String(m).padStart(2,'0')}:${String(s).padStart(2,'0')}`; }

    function bestKey(mode){ return `nadja.memory.best.${mode}`; }
    function loadBest(mode){
      try{ return JSON.parse(localStorage.getItem(bestKey(mode))||'null'); }catch(e){ return null; }
    }
    function saveBest(mode, data){
      try{ localStorage.setItem(bestKey(mode), JSON.stringify(data)); }catch(e){}
    }

    function renderGrid(mode){
      const {cols,rows,deck} = deckForMode(mode);
      console.log('Rendering grid:', {mode, cols, rows, deckLength: deck.length});
      memoryUI.grid.dataset.mode = mode;
      memoryUI.grid.style.gridTemplateColumns = `repeat(${cols}, minmax(44px,1fr))`;
      memoryUI.grid.innerHTML = '';

      memoryState = { mode, cols, rows, deck, first:null, lock:false, moves:0, time:0, timer:null, matched:0, started:false };

      deck.forEach((card,idx)=>{
        console.log(`Card ${idx}:`, card.emoji);
        
        const tile = document.createElement('button');
        tile.className = 'tile';
        tile.type = 'button';
        tile.setAttribute('aria-label', 'Verdeckt');
        tile.setAttribute('data-idx', String(idx));
        tile.setAttribute('data-emoji', card.emoji); // Speichere Emoji als data-Attribut
        
        const face = document.createElement('div');
        face.className = 'tile-face';
        face.textContent = '★'; // Start mit Stern
        
        tile.appendChild(face);
        
        tile.addEventListener('click', onFlip);
        tile.addEventListener('keydown', e=>{ 
          if(e.code==='Enter'||e.code==='Space') { 
            e.preventDefault(); 
            tile.click(); 
          }
        });
        
        memoryUI.grid.appendChild(tile);
      });
      
      console.log('Created tiles:', memoryUI.grid.children.length);
      console.log('Grid HTML:', memoryUI.grid.innerHTML.substring(0, 200));

      memoryUI.moves.textContent = '0';
      memoryUI.time.textContent = '00:00';
      const best = loadBest(mode);
      memoryUI.best.textContent = best ? `${best.moves} / ${fmtTime(best.time)}` : '—';
    }

    function startTimer(){
      if(memoryState.started) return;
      memoryState.started = true;
      memoryState.timer = setInterval(()=>{
        memoryState.time += 1;
        memoryUI.time.textContent = fmtTime(memoryState.time);
      }, 1000);
    }

    function stopTimer(){
      if(memoryState.timer){ clearInterval(memoryState.timer); memoryState.timer = null; }
    }

    function onFlip(e){
      const tile = e.currentTarget;
      if(memoryState.lock || tile.disabled) return;
      const idx = parseInt(tile.getAttribute('data-idx'),10);
      const card = memoryState.deck[idx];
      const emoji = tile.getAttribute('data-emoji');

      if(!memoryState.started) startTimer();
      if(tile.classList.contains('flipped')) return;

      tile.classList.add('flipped');
      // Zeige Emoji direkt!
      const face = tile.querySelector('.tile-face');
      face.textContent = emoji;
      tile.setAttribute('aria-label', emoji);

      if(!memoryState.first){
        memoryState.first = {idx, tile, emoji: card.emoji};
        return;
      }

      if(memoryState.first.idx === idx) return;

      memoryState.lock = true;
      memoryState.moves += 1;
      memoryUI.moves.textContent = String(memoryState.moves);

      const first = memoryState.first;
      const second = {idx, tile, emoji: card.emoji};

      const isMatch = first.emoji === second.emoji;
      const settle = ()=>{
        if(!isMatch){
          // Zurücksetzen: Stern wieder anzeigen
          first.tile.classList.remove('flipped');
          second.tile.classList.remove('flipped');
          first.tile.querySelector('.tile-face').textContent = '★';
          second.tile.querySelector('.tile-face').textContent = '★';
          first.tile.setAttribute('aria-label','Verdeckt');
          second.tile.setAttribute('aria-label','Verdeckt');
        } else {
          first.tile.disabled = true;
          second.tile.disabled = true;
          memoryState.matched += 2;
          
          if(memoryState.matched === memoryState.deck.length){
            stopTimer();
            const best = loadBest(memoryState.mode);
            const better = !best || memoryState.moves < best.moves || (memoryState.moves===best.moves && memoryState.time < best.time);
            if(better) saveBest(memoryState.mode, {moves: memoryState.moves, time: memoryState.time});

            if(window.matchMedia('(prefers-reduced-motion: no-preference)').matches){
              memoryUI.grid.style.animation = 'victory-pulse 0.6s ease-in-out';
              setTimeout(()=> memoryUI.grid.style.animation = '', 600);
            }
            
            const nb = loadBest(memoryState.mode);
            memoryUI.best.textContent = nb ? `${nb.moves} / ${fmtTime(nb.time)}` : '—';
            
            setTimeout(()=>{
              alert(`🎉 Gewonnen! Züge: ${memoryState.moves}, Zeit: ${fmtTime(memoryState.time)}`);
            }, 300);
          }
        }
        memoryState.first = null;
        memoryState.lock = false;
      };

      const delay = isMatch ? 220 : (window.matchMedia('(prefers-reduced-motion: reduce)').matches ? 0 : 620);
      setTimeout(settle, delay);
    }

    function openMemory(){
      lastFocusEl = document.activeElement;
      memoryUI.overlay.hidden = false;
      memoryUI.overlay.setAttribute('aria-hidden','false');
      memoryUI.closeBtn.focus();
      renderGrid(memoryUI.modeSel.value);
    }

    function closeMemory(){
      memoryUI.overlay.hidden = true;
      memoryUI.overlay.setAttribute('aria-hidden','true');
      stopTimer();
      if(lastFocusEl && lastFocusEl.focus) lastFocusEl.focus();
    }

    // Debug: Check if elements exist
    console.log('Memory elements:', {
      openBtn: memoryUI.openBtn,
      overlay: memoryUI.overlay,
      closeBtn: memoryUI.closeBtn
    });

    if(memoryUI.openBtn){
      memoryUI.openBtn.addEventListener('click', openMemory);
      console.log('Memory button click listener attached');
    } else {
      console.error('Memory button not found!');
    }
    
    if(memoryUI.closeBtn){
      memoryUI.closeBtn.addEventListener('click', closeMemory);
    }
    
    if(memoryUI.modeSel){
      memoryUI.modeSel.addEventListener('change', ()=>renderGrid(memoryUI.modeSel.value));
    }
    
    if(memoryUI.restartBtn){
      memoryUI.restartBtn.addEventListener('click', ()=>renderGrid(memoryUI.modeSel.value));
    }
    
    document.addEventListener('keydown', e=>{ 
      if(!memoryUI.overlay.hidden && e.key==='Escape') closeMemory(); 
    });

  </script>

</body>
</html>
